pipeline {
    agent any

    stages {

        stage("Test ðŸ§ª") {
            steps {
                echo "Lancement des tests BACK"
                sh '''
                    cd ${WORKSPACE}/proto-back/
                    mvn test
                '''

                echo "Lancement des tests FRONT"
                sh '''
                    cd ${WORKSPACE}/proto-front
                    chmod +x ./node_modules/.bin/react-scripts
                    chmod -R 755 ./node_modules
                    rm -rf node_modules
                    npm install
                    npx update-browserslist-db@latest
                    npm install --save-dev @babel/plugin-proposal-private-property-in-object
                    npm test
                '''
            }
        }

        stage("Package ðŸ“¦") {
            steps {

                echo "Compilation du BACK"
                sh '''
                    cd ${WORKSPACE}/proto-back
                    mvn clean package
                '''

                echo "Compilation du FRONT"
                sh '''
                    cd ${WORKSPACE}/proto-front
                    npm run build
                '''
                
            }
        }

        stage("Deliver ðŸšš") {
            steps {
                echo "Livraison des fichiers (WIP)"
                sh "cd .."
                sh "scripts/deploy.sh"
            }
        }

        stage("Start ðŸš€") {
            steps {
                sh "scripts/start.sh"
            }
        }
    }
}